# Base image: Rust build environment with cached dependencies
# Rebuild only when Cargo.toml / Cargo.lock change.
#
#   docker build -f Dockerfile.base -t resawod-base .
#
FROM rust:1.93-slim-bookworm

RUN apt-get update && apt-get install -y pkg-config libssl-dev && rm -rf /var/lib/apt/lists/*

WORKDIR /build

# Cache dependency compilation
COPY Cargo.toml Cargo.lock* ./
RUN mkdir src && echo 'fn main() {}' > src/main.rs && cargo build --release && rm -rf src
